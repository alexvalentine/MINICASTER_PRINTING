DVAR $hFile
DVAR $cCheck
DVAR $press
DVAR $length
DVAR $lame
DVAR $comport


$DO0.0=0
$DO1.0=0
$DO2.0=0
$DO3.0=0

Primary ; sets primary units mm and s
G65 F2000; accel speed mm/s^2
G66 F2000;accel speed mm/s^2


G91
G92 X0.000000 Y0.000000 Z0.000000
G1 F25
Call setPress P4 Q40
G90
G1 Z5.000000
G91
G90
G1 X2.000000 Y25.000000
G91
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G1 F1
G1 Y-20.000000
G1 F20
Call togglePress P4
G16 X Y Z
G18
G2 X0.000000 Z6.000000 R3.000000
Call setPress P4 Q40
G90
G1 X25.000000 Y15.000000
G91
G92 X0.000000 Y0.000000
G1 Y2.000000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y0.400000
G90
G1 Z0.030000
G91
G1 F1
Call togglePress P4
G4 P0.5
G90
G1 Y20.400000
G91
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
G1 X0.400000 Y-0.400000
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G90
G1 Y0.000000
G91
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G90
G1 X0.000000 Y0.000000
G91
G90
G1 Z0.030000
G91
Call togglePress P4
G4 P0.5
G1 F0.3
G90
G1 X20.400000 Y0.000000
G91
G1 X4.000000 Y-4.000000
G1 F0.2
G17
G2 X1.000000 Y0.000000 R0.500000
G17
G2 X-1.000000 Y0.000000 R0.500000
G1 X0.200000
G17
G2 X0.600000 Y0.000000 R0.300000
G17
G2 X-0.600000 Y0.000000 R0.300000
G1 X0.200000
G17
G2 X0.200000 Y0.000000 R0.100000
G17
G2 X-0.200000 Y0.000000 R0.100000
Call togglePress P4
G16 X Y Z
G19
G3 Y0.000000 Z2.000000 R1.000000
G90
G1 X0.200000 Y20.400000
G91
G90
G1 Z0.030000
G91
Call togglePress P4
G1 F0.3
G4 P0.5
G1 F0.2
G90
G1 X20.400000
G91
G1 X4.000000 Y4.000000
G1 F0.2
G17
G2 X1.000000 Y0.000000 R0.500000
G17
G2 X-1.000000 Y0.000000 R0.500000
G1 X0.200000
G17
G2 X0.600000 Y0.000000 R0.300000
G17
G2 X-0.600000 Y0.000000 R0.300000
G1 X0.200000
G17
G2 X0.200000 Y0.000000 R0.100000
G17
G2 X-0.200000 Y0.000000 R0.100000
Call togglePress P4
G16 X Y Z
G19
G2 Y0.000000 Z2.000000 R1.000000
;#################################### Code ##########################################

M2

;##########Functions############;
DFS setPress        
         
        $strtask1 = DBLTOSTR( $P, 0 )            
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000
                             
        $press = $Q * 10.0                             
        $strtask2 = DBLTOSTR( $press , 0 )  
      
      
        $length = STRLEN( $strtask2 )      
        WHILE $length < 4.0
                $strtask2 = "0" + $strtask2    
                $length = STRLEN( $strtask2 ) 
        ENDWHILE


        $strtask2 = "08PS  " + $strtask2
                                    
        $cCheck = 0.00     
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 6) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 7) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 8) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 9)  
        $cCheck = $cCheck - $lame
                        
        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE                        


        $strtask3 = makestring "{#H}" $cCheck   
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"
            
        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile


ENDDFS


DFS togglePress        
         
        $strtask1 = DBLTOSTR( $P, 0 )            
        $strtask1 = "COM" + $strtask1
        $hFile = FILEOPEN $strtask1, 2
        COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
        COMMSETTIMEOUT $hFile, -1, -1, 1000


        $strtask2 = "04DI  "
                                    
        $cCheck = 0.00     
        $lame = STRTOASCII ($strtask2, 0)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 1) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 2) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 3) 
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 4)
        $cCheck = $cCheck - $lame
        $lame = STRTOASCII( $strtask2, 5) 
        $cCheck = $cCheck - $lame
                        
        WHILE( $cCheck) < 0
                $cCheck = $cCheck + 256
        ENDWHILE                        


        $strtask3 = makestring "{#H}" $cCheck   
        $strtask3 = STRUPR( $strtask3 )
        $strtask2 = "\x02" + $strtask2 + $strtask3 + "\x03"
                  
        FILEWRITE $hFile "\x05"
        FILEWRITE $hFile $strtask2
        FILEWRITE $hFile "\x04"


        FILECLOSE $hFile
        G4 P0.15

ENDDFS